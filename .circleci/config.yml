version: 2.1

orbs:
  golangci: ory/golangci@0.0.18

jobs:
  test:
    docker:
      -
        image: circleci/golang:1.16
    steps:
      - checkout
      -
        run: make tools
      -
        run: go-acc -o coverage.txt ./... -- -v -failfast -timeout=20m -tags sqlite
      -
        run: bash <(curl -s https://codecov.io/bash)

workflows:
  test:
    jobs:
      - golangci/lint
      - test